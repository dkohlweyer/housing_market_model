when_collect(model, s) = model.day_in_month == 20

output(m) = m.statistics.total_output_in_month
capacity_utilization_rate(m) = m.statistics.capacity_utilization_rate
central_bank_rate(m) = m.central_bank_rate
total_estimated_demand(m) = sum(map(f -> f.estimated_demand, values(m.active_firms)))
total_demand_buffer(m) = sum(map(f -> f.demand_buffer, values(m.active_firms)))
planned_output(m) = m.statistics.total_planned_output_in_month
unemployment(m) = m.statistics.unemployment_rate
productivity(m) = m.statistics.average_productivity
total_debt(m) = m.statistics.total_debt
technological_frontier(m) = m.capital_goods_producer.vintage_productivities[m.capital_goods_producer.best_available_vintage]
active_firms(m) = m.statistics.active_firms
active_banks(m) = sum(map(b -> b.active_business, values(m.banks)))

bank_average_equity(m) = mean(map(b -> b.equity, values(m.commercial_banks)))
bank_average_deposits(m) = mean(map(b -> b.deposits, values(m.commercial_banks)))
bank_average_central_bank_debt(m) = mean(map(b -> b.central_bank_debt, values(m.commercial_banks)))
bank_average_reserves(m) = mean(map(b -> b.reserves, values(m.commercial_banks)))
bank_average_total_loans(m) = mean(map(b -> b.total_loans, values(m.commercial_banks)))
bank_average_total_mortgages(m) = mean(map(b -> b.total_mortgages, values(m.commercial_banks)))
bank_average_profit(m) = mean(map(b -> b.profit, values(m.commercial_banks)))
bank_average_interest_expense_deposits(m) = mean(map(b -> b.interest_expense_deposits, values(m.commercial_banks)))
bank_average_interest_expense_cb_debt(m) = mean(map(b -> b.interest_expense_central_bank_debt, values(m.commercial_banks)))
bank_average_interest_income_reserves(m) = mean(map(b -> b.interest_income_reserves, values(m.commercial_banks)))
bank_average_funding_costs(m) = mean(map(b -> b.funding_costs, values(m.commercial_banks)))
bank_average_mortgage_pd_pit(m) = mean(map(b -> b.mortgage_pd_pit, values(m.commercial_banks)))
bank_average_mortgage_lgd_pit(m) = mean(map(b -> b.mortgage_lgd_pit, values(m.commercial_banks)))
bank_average_mortgage_pd_pit_yearly(m) = mean(map(b -> b.mortgage_pd_pit_yearly, values(m.commercial_banks)))
bank_average_mortgage_rate(m) = mean(map(b -> b.mortgage_interest_rate, values(m.commercial_banks)))
bank_average_mortgage_rate_spread(m) = mean(map(b -> b.mortgage_interest_rate_spread, values(m.commercial_banks)))
bank_average_loan_pd_pit(m) = mean(map(b -> b.loan_pd_pit, values(m.commercial_banks)))
bank_average_loan_lgd_pit(m) = mean(map(b -> b.loan_lgd_pit, values(m.commercial_banks)))
bank_average_loan_pd_pit_yearly(m) = mean(map(b -> b.loan_pd_pit_yearly, values(m.commercial_banks)))
bank_average_number_loans(m) = mean(map(b -> b.number_loans_in_month_history[1], values(m.commercial_banks)))
bank_average_number_mortgages(m) = mean(map(b -> b.number_mortgages_in_month_history[1], values(m.commercial_banks)))
bank_average_writeoff_mortgages(m) = mean(map(b -> b.writeoff_mortgages_in_month, values(m.commercial_banks)))
bank_average_writeoff_loans(m) = mean(map(b -> b.writeoff_loans_in_month, values(m.commercial_banks)))
bank_average_risk_weight_mortgages(m) = mean(map(b -> b.risk_weight_mortgages, values(m.commercial_banks)))
bank_average_capital_adequacy_ratio(m) = mean(map(b -> b.capital_adequacy_ratio, values(m.commercial_banks)))

credit_rationed_households(m) = m.statistics.credit_rationed_households

credit_rationed_firms(m) = m.statistics.credit_rationed_firms
average_vintage_choice(m) = m.statistics.average_vintage_choice
total_investment(m) = m.statistics.total_investment
total_money_firms(m) = m.statistics.total_money_firms
share_firms_full_payout(m) = m.statistics.share_firms_full_payout
average_profit_firms(m) = m.statistics.average_profit_firms
average_dividends_firms(m) = m.statistics.average_dividends_firms
average_wage(m) = m.statistics.average_wage
average_base_wage(m) = m.statistics.average_base_wage
consumer_price_index(m) = m.statistics.consumer_price_index
std_dev_firm_sizes(m) = std(map(f -> f.last_production, values(m.active_firms)))
gov_balance(m) = m.government.payment_account
gov_income(m) = m.government.income_in_month
gov_expenses(m) = m.government.expenses_in_month
gov_tax_base(m) = m.government.tax_base_in_month
gov_tax_rate(m) = m.government.tax_rate
hh_monthly_labor_income(m) = m.statistics.hh_monthly_labor_income
hh_monthly_dividend_income(m) = m.statistics.hh_monthly_dividend_income
hh_monthly_interest_income(m) = m.statistics.hh_monthly_interest_income
hh_monthly_social_benefits(m) = m.statistics.hh_monthly_social_benefits
hh_average_balance(m) = mean(map(h -> h.payment_account, values(m.households)))
hh_consumption_budget_in_month(m) = mean(map(h -> h.consumption_budget_in_month, values(m.households)))
labor_share(m) = m.statistics.hh_monthly_labor_income / m.statistics.hh_monthly_total_income
firm_avg_last_interest_rate(m) = mean(map(f -> f.last_loan_interest_rate, values(m.active_firms)))
firm_avg_equity(m) = mean(map(f -> f.equity, values(m.active_firms)))
firm_avg_balance(m) = mean(map(f -> f.payment_account, values(m.active_firms)))
firm_selected_price_active(m) = mean(map(f -> f.selected_price, values(m.active_firms)))
firm_selected_price_inactive(m) = mean(map(f -> f.selected_price, values(m.inactive_firms)))
firm_std_price(m) = std(map(f -> f.price, values(m.active_firms)))
firm_average_error_estimated_demand(m) = mean(map(f -> f.error_demand_estimation, values(m.active_firms)))
cg_producer_balance(m) = m.capital_goods_producer.payment_account
tenants(m) = m.statistics.housing_number_tenants
owners(m) = m.statistics.housing_number_owners
landlords(m) = m.statistics.housing_number_landlords
homeless(m) = m.statistics.housing_number_homeless
average_rent(m) = m.statistics.housing_average_rent
hpi(m) = m.housing_market.house_price_index
rpi(m) = m.housing_market.rent_price_index
hpi_growth(m) = m.housing_market.house_price_index_growth
rpi_growth(m) = m.housing_market.rent_price_index_growth
hquality(m) = m.housing_market.housing_market_average_quality
rquality(m) = m.housing_market.rental_market_average_quality
hm_average_price(m) = m.housing_market.housing_market_average_price
rm_average_price(m) = m.housing_market.rental_market_average_price
hm_average_offer_price(m) = m.housing_market.housing_market_average_offer_price
rm_average_offer_price(m) = m.housing_market.rental_market_average_offer_price
hm_bids(m) = m.housing_market.housing_market_no_bids
hm_offers(m) = m.housing_market.housing_market_no_offers
hm_matches(m) = m.housing_market.housing_market_no_matches
hm_time_on_market(m) = m.housing_market.housing_market_average_time_on_market
rm_bids(m) = m.housing_market.rental_market_no_bids
rm_offers(m) = m.housing_market.rental_market_no_offers
rm_matches(m) = m.housing_market.rental_market_no_matches
inflation_yoy(m) = m.statistics.consumer_price_index_yearly_growth
market_size(m) = m.statistics.market_size
mortgage_credit_growth_yoy(m) = m.statistics.mortgage_credit_growth_yoy
output_growth_yoy(m) = m.statistics.monthly_output_growth_yoy
average_ltv_requested(m) = m.mortgage_market.average_ltv_requested
average_ltv_granted(m) = m.mortgage_market.average_ltv_granted
average_dsti_requested(m) = m.mortgage_market.average_dsti_requested
average_dsti_granted(m) = m.mortgage_market.average_dsti_granted
min_consumption(m) = m.statistics.minimum_consumption_level
ltv_cap(m) = m.ltv_cap

cumulative_output(m) = m.statistics.cumulated_output

no_hmr(m) = sum(map(h -> h.no_hmr, values(m.households)))
no_hmr_for_sale(m) = sum(map(h -> h.no_hmr_for_sale, values(m.households)))
no_op_for_sale(m) = sum(map(h -> h.no_op_for_sale, values(m.households)))
no_op_occupied(m) = sum(map(h -> h.no_op_occupied, values(m.households)))
no_op_vacant(m) = sum(map(h -> h.no_op_vacant, values(m.households)))
homeless_before(m) = sum(map(h -> h.homeless_before, values(m.households)))
homeless_after(m) = sum(map(h -> h.homeless_after, values(m.households)))

mdata = [firm_average_error_estimated_demand, homeless_before, homeless_after, no_hmr, no_hmr_for_sale, no_op_for_sale, no_op_occupied,no_op_vacant,bank_average_capital_adequacy_ratio, hh_consumption_budget_in_month, bank_average_mortgage_rate_spread,ltv_cap, cumulative_output, credit_rationed_households, consumer_price_index, output, total_estimated_demand, total_demand_buffer, planned_output, unemployment, productivity, total_debt, active_firms, credit_rationed_firms, total_investment, total_money_firms, share_firms_full_payout, average_profit_firms, average_dividends_firms, average_wage, std_dev_firm_sizes, gov_balance, active_banks, firm_avg_last_interest_rate, firm_avg_equity, tenants,owners,landlords,homeless,average_rent, hpi, rpi, hpi_growth, rpi_growth, hquality, rquality,hm_average_price,rm_average_price,hm_average_offer_price,rm_average_offer_price,hm_bids,hm_offers,hm_time_on_market,hm_matches,rm_bids,rm_offers,rm_matches,inflation_yoy,mortgage_credit_growth_yoy,output_growth_yoy,
average_ltv_granted,average_ltv_requested, average_dsti_requested, average_dsti_granted, min_consumption,gov_tax_rate,capacity_utilization_rate,central_bank_rate,
bank_average_number_loans,bank_average_number_mortgages,bank_average_loan_pd_pit, bank_average_loan_lgd_pit, bank_average_loan_pd_pit_yearly, bank_average_mortgage_pd_pit, bank_average_mortgage_lgd_pit, bank_average_mortgage_pd_pit_yearly, bank_average_mortgage_rate,bank_average_equity, bank_average_risk_weight_mortgages,bank_average_writeoff_mortgages,bank_average_writeoff_loans,bank_average_profit,bank_average_deposits,bank_average_central_bank_debt,bank_average_reserves,bank_average_total_loans,bank_average_total_mortgages,bank_average_interest_expense_deposits,bank_average_interest_expense_cb_debt,bank_average_interest_income_reserves,bank_average_funding_costs]
adata = nothing
